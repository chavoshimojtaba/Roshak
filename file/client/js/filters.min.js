window.filtersViewModel={serviceType:"",cityId:ko.observable(null),areas:ko.observableArray([]),areaId:ko.observable(null),name:ko.observable(""),firstLoadPage:ko.observable(!0),dimensionsSlider:null,dimensions:ko.observable({min:100,max:15e4,min_default:100,max_default:15e4}),monitorresolutionSlider:null,monitorresolution:ko.observable({min:380,max:2024,min_default:0,max_default:380}),data:ko.observable([]),pageHeaderTitle:ko.observable(),paginator:ko.observable(""),description:ko.observable({title:"",content:""}),tags:ko.observableArray(),statusSell:ko.observable(!1),vicinity:ko.observable(!1),vicinityError:ko.observable(!1),f_gender:ko.observable(),f_type:ko.observable(),services:ko.observableArray(),selectedService:ko.observable(),isSelected:ko.observable(!1),statusSellTag:ko.observable({type:"status_sell",value:1,title:"فروش فعال طرح پیچ"}),nanobarInterval:null,nanobarProgress:0,attributesGroups:ko.observableArray(),viewAttributes:ko.pureComputed({read:function(){var i;return 0<filtersViewModel.attributeSearch().length?(i=[],$.each(filtersViewModel.attributes(),function(e,t){0<=t.name.indexOf(filtersViewModel.attributeSearch())&&i.push(t)}),i):filtersViewModel.attributes()}}),selectedAttributes:ko.observableArray(),moreAttributes:ko.observable(!1),attributeSearch:ko.observable(""),hasDefaultAttributes:ko.observable(!1),afterFirstRequest:ko.observable(!1),beforeState:[],afterState:[],loading:ko.observable(!1),pageTitle:ko.observable(""),view:ko.observable("results"),state:null,sortList:ko.observableArray([]),sortedBy:ko.observableArray(),defaultSort:"views",startEditMode:function(){this.beforeState=this.tags.slice(0)},discardEditMode:function(){this.tags(this.beforeState),this.beforeState=[]},submitEditMode:function(){this.beforeState=[]},showFilters:function(){this.startEditMode(),$("body").addClass("fixed"),filtersViewModel.view("filters"),resizeModalFilter()},discardFilters:function(){this.discardEditMode(),this.setFiltersFromTags(),$("body").removeClass("fixed"),filtersViewModel.view("results")},setFiltersFromTags:function(){let i=this;var r=["name","city","area","gender","type","service","vicinity","saens_resolution","dimensions"],e=(this.selectedAttributes.removeAll(),this.tags().slice(0));$.each(e,function(e,t){switch(t.type){case"name":i.name(t.value),r.splice(r.indexOf("name"),1);break;case"city":i.cityId(t.value),r.splice(r.indexOf("city"),1);break;case"area":i.refreshAreas(function(){i.areaId(t.value)}),r.splice(r.indexOf("area"),1);break;case"gender":i.f_gender(t.value),r.splice(r.indexOf("gender"),1);break;case"type":i.f_type(t.value),r.splice(r.indexOf("type"),1);break;case"service":i.selectedService(t.service_id),r.splice(r.indexOf("service"),1);break;case"attr":i.selectedAttributes.push(t.attribute_id);break;case"vicinity":i.vicinity(!0),$("#city").prop("disabled",!0),r.splice(r.indexOf("vicinity"),1);break;case"saens_resolution":i.monitorresolutionSlider.noUiSlider.set([t.min+6,t.max+6]),r.splice(r.indexOf("saens_resolution"),1);break;case"dimensions":i.dimensionsSlider.noUiSlider.set([t.min,t.max]),r.splice(r.indexOf("dimensions"),1)}}),$.each(r,function(e,t){switch(t){case"name":i.name("");break;case"city":i.cityId("all");break;case"area":i.refreshAreas();break;case"gender":i.f_gender("all");break;case"type":i.f_type("all");break;case"service":i.selectedService("");break;case"vicinity":i.vicinity(!1);break;case"saens_resolution":i.monitorresolutionSlider.noUiSlider.set([i.monitorresolution().min_default,i.monitorresolution().max_default]);break;case"dimensions":i.dimensionsSlider.noUiSlider.set([i.dimensions().min_default,i.dimensions().max_default])}})},setFilters:function(){this.submitEditMode(),filtersViewModel.submitFilter(),$("body").removeClass("fixed"),filtersViewModel.view("results")},submitFilter:function(){$(".search-box").removeClass("has-result"),this.updateName(),this.request(this.buildUrl(),!0),$("#filters").modal("hide"),this.vicinityError(!1)},buildUrl:function(){var e=filtersViewModel.buildBaseUrl(),e=filtersViewModel.buildCityUrl(e);return e=filtersViewModel.buildAttrUrl(e),filtersViewModel.buildQueryString(e)},buildBaseUrl:function(){return window.BASE_URL+"/"+filtersViewModel.printService()},printService:function(){switch(filtersViewModel.selectedService()){case 0:return"data";case 1:return"courses";case 2:return"packs";case 3:return"massages";case 4:return"turkish-baths";case 5:return"waterparks";case 6:return"amusements";default:return"search"}},buildCityUrl:function(e){return filtersViewModel.cityId()&&"all"!==filtersViewModel.cityId()?e+="/"+filtersViewModel.cityId():1==filtersViewModel.selectedAttributes().length&&(e+="/all"),e},buildAttrUrl:function(e){var i,r;return 1===filtersViewModel.selectedAttributes().length&&(i=filtersViewModel.selectedAttributes()[0],$.each(filtersViewModel.attributesGroups(),function(e,t){if(void 0!==(r=t.attributes.find(e=>e.attribute_id==i)))return!1}),e+="/attr/"+r.url),e},buildQueryString:function(e){var t=[],t=filtersViewModel.collectTags(t),i=this.getSort();return 0<i.length&&t.push(i),0<t.length?e+"?"+t.join("&"):e},collectTags:function(r){var s=filtersViewModel.lengthOfAttributes(),n="";return $.each(filtersViewModel.tags(),function(e,t){var i;!0!==t.ignore_query&&(void 0!==t.queryStringType&&"array"==t.queryStringType?"attr"===t.type&&1<s&&(0==n.length?n="attrs="+encodeURIComponent(t.value):n+=","+encodeURIComponent(t.value)):void 0!==t.query?r.push(t.query):("name"==(i=t.type)&&(i="q"),r.push(encodeURIComponent(i)+"="+encodeURIComponent(t.value))))}),0<n.length&&r.push(n),r},lengthOfAttributes:function(){return filtersViewModel.tags().filter(e=>"attr"===e.type).length},addToQuery:function(e,t,i){return i.push(e+"="+t),i},request:function(e,t,i){if(filtersViewModel.requestStart(),filtersViewModel.notSupportPushState())return filtersViewModel.refreshPage(e);t&&filtersViewModel.pushState(e),$.ajax({url:e,dataType:"json",type:"GET",cache:!1,success:function(e){filtersViewModel.requestFinish(),filtersViewModel.changeTitle(e),filtersViewModel.viewRender(e),void 0!==i&&i(e),filtersViewModel.afterFirstRequest(!0)},erorr:function(){return filtersViewModel.refreshPage(e)}})},notSupportPushState:function(){var e=navigator.userAgent;return(-1!==e.indexOf("Android 2.")||-1!==e.indexOf("Android 4.0"))&&-1!==e.indexOf("Mobile Safari")&&-1===e.indexOf("Chrome")&&-1===e.indexOf("Windows Phone")&&"file:"!==location.protocol||!(window.history&&"pushState"in window.history)},refreshPage:function(e){window.location=e},pushState:function(e){this.saveCurrentState(),window.history.pushState(this.state,null,e)},changeTitle:function(e){document.title=e.title,filtersViewModel.pageTitle(e.subject)},viewRender:function(e){filtersViewModel.data(e.data),filtersViewModel.paginator(e.paginator),e.description_content&&($("#static-description").remove(),filtersViewModel.description({title:e.description_title,content:e.description_content})),$("html,body").scrollTop(0),$(".list-card .list-card-item").show()},requestStart:function(){this.loading(!0),this.nanobarStart(),this.description({title:"",content:""}),$(".page .category .container").prepend('<div class="loading-overlay"></div>')},requestFinish:function(){filtersViewModel.loading(!1),filtersViewModel.nanobarFinish(),$(".list-card .list-card-item.backend-render").remove(),$(".pagination-container.backend-render").remove(),$(".empty-state.backend-render").remove(),$(".description-content.backend-render").remove()},nanobarStart:function(){},nanobarFinish:function(){},updateName:function(){this.removeTagWhere(["type","name"]),void 0!==this.name()&&0<this.name().length&&this.tags.push({type:"name",value:this.name(),title:this.name()})},cityChange:function(){this.removeTagWhere(["type","city"]),"all"!==this.cityId()&&this.tags.push({type:"city",value:this.cityId(),title:$("#reg-city option:selected").text(),ignore_query:!0}),this.refreshAreas()},areaChange:function(){this.removeTagWhere(["type","area"]),"all"!==this.areaId()&&this.tags.push({type:"area",value:this.areaId(),title:$("#reg-area option:selected").text()})},refreshAreas:function(t){let i=this;"all"==this.cityId()?this.areas(this.allAreaOption()):$.ajax({url:window.BASE_URL+"/profile/areas",data:{city_id:this.cityId()},method:"GET",dataType:"json",cache:!0}).done(function(e){e.status||i.areas(i.allAreaOption()),i.areas(i.allAreaOption().concat(e.areas)),i.areaId("all"),null!=t&&t()}).fail(function(e){return i.areas(i.allAreaOption()),!1})},allAreaOption:function(){return[{name:"همه مناطق",area_id:"all"}]},vicinityChange:function(){var t=this;this.vicinity()?(this.cityId("all"),this.areaId("all"),$("#reg-city").trigger("change"),$("#reg-area").trigger("change"),navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){t.updateVicinity(e.coords.latitude,e.coords.longitude,!1)},function(e){t.vicinity(!1).vicinityError(!0)}):this.vicinity(!1).vicinityError(!0)):this.vicinityError(!1)},updateVicinity:function(e,t,i){this.removeTagWhere(["type","vicinity"]),this.tags.push({type:"vicinity",query:"lat="+e+"&lng="+t,title:"مجموعه‌های اطراف من"}),this.vicinityError(!i)},dimensionsChange:function(){this.removeTagWhere(["type","dimensions"]),this.dimensions().min_default==this.dimensions().min&&this.dimensions().max_default==this.dimensions().max||this.tags.push({type:"dimensions",query:"dimensions[min]="+this.dimensions().min+"&dimensions[max]="+this.dimensions().max,title:"از "+this.dimensions().min.toString().toPersianDigits()+" تا "+this.dimensions().max.toString().toPersianDigits()+" تومان",min:this.dimensions().min,max:this.dimensions().max})},monitorresolutionChange:function(){this.removeTagWhere(["type","saens_resolution"]),0==this.monitorresolution().min&&24==this.monitorresolution().max||this.tags.push({type:"saens_resolution",query:"saens_resolution[min]="+this.monitorresolution().min+"&saens_resolution[max]="+this.monitorresolution().max,title:"از  "+this.resolutionFormat(this.monitorresolution().min)+" تا "+this.resolutionFormat(this.monitorresolution().max),min:this.monitorresolution().min,max:this.monitorresolution().max})},genderChange:function(){filtersViewModel.removeTagWhere(["type","gender"]),filtersViewModel.f_gender($(".f_gender:checked").val()),"all"!==filtersViewModel.f_gender()&&filtersViewModel.tags.push({type:"gender",value:filtersViewModel.f_gender(),title:$(".f_gender:checked").closest("label").text().trim()})},statusSellChange:function(){filtersViewModel.statusSell()?filtersViewModel.tags.push(filtersViewModel.statusSellTag()):filtersViewModel.removeTag(filtersViewModel.statusSellTag())},typeChange:function(e,t,i){filtersViewModel.removeTagWhere(["type","type"]),"all"!==filtersViewModel.f_type()&&filtersViewModel.tags.push({type:"type",value:filtersViewModel.f_type(),title:e})},removeTagWhere:function(r,e){var s=!0;(e=void 0!==e&&e)?$.each(filtersViewModel.tags(),function(e,t){$.each(filtersViewModel.tags(),function(e,t){s=!0;for(var i=0;i<r.length;i+=2)t[r[i]]!==r[i+1]&&(s=!1);if(s)return filtersViewModel.tags.splice(e,1),!1})}):$.each(filtersViewModel.tags(),function(e,t){s=!0;for(var i=0;i<r.length;i+=2)t[r[i]]!==r[i+1]&&(s=!1);if(s)return filtersViewModel.tags.splice(e,1),!1})},removeTag:function(e,t){switch(filtersViewModel.tags.remove(e),e.type){case"name":filtersViewModel.name("");break;case"city":filtersViewModel.cityId("all"),$("#reg-city").trigger("change");break;case"area":filtersViewModel.areaId("all"),$("#reg-area").trigger("change");break;case"gender":filtersViewModel.f_gender("all"),$("#all-genders").prop("checked",!0);break;case"type":filtersViewModel.f_type("all");break;case"vicinity":filtersViewModel.vicinity(!1),filtersViewModel.vicinityChange();break;case"service":filtersViewModel.selectedService(""),filtersViewModel.serviceChange();break;case"attr":filtersViewModel.selectedAttributes.remove(e.attribute_id),filtersViewModel.attributeChange();break;case"tag":break;case"saens_resolution":filtersViewModel.monitorresolutionSlider.noUiSlider.set([filtersViewModel.monitorresolution().min_default+6,filtersViewModel.monitorresolution().max_default+6]);break;case"dimensions":filtersViewModel.dimensionsSlider.noUiSlider.set([filtersViewModel.dimensions().min_default,filtersViewModel.dimensions().max_default]);break;case"status_sell":filtersViewModel.statusSell(!1),filtersViewModel.removeTagWhere(["type","status_sell"])}t&&filtersViewModel.submitFilter()},clearFilters:function(i=[]){var e=filtersViewModel.tags().slice(0);$.each(e,function(e,t){if(i.includes(t.type))return!1;filtersViewModel.removeTag(t,!1)})},clearFiltersAndSubmit:function(){this.clearFilters([]),this.submitFilter()},init:function(){this.initdimensionsSlider(),this.initmonitorresolutionSlider()},loadData:function(){window.location.search.substring(1)},initdimensionsSlider:function(){let i=this;this.dimensions().min=isNaN(parseInt($("#min-dimensions").text()))?this.dimensions().min_default:parseInt($("#min-dimensions").text()),this.dimensions().max=isNaN(parseInt($("#max-dimensions").text()))?this.dimensions().max_default:parseInt($("#max-dimensions").text()),this.dimensionsChange(),this.dimensionsSlider=document.getElementById("dimensions-range"),noUiSlider.create(this.dimensionsSlider,{start:[this.dimensions().min,this.dimensions().max],connect:!0,step:5e3,direction:"rtl",range:{min:this.dimensions().min_default,max:this.dimensions().max_default}}),this.dimensionsSlider.noUiSlider.on("change",function(e){var t=parseInt(e[0]),e=parseInt(e[1]);document.getElementById("min-dimensions").innerHTML=t.toString().toPersianDigits(),document.getElementById("max-dimensions").innerHTML=e.toString().toPersianDigits(),i.dimensions($.extend(i.dimensions(),{min:t,max:e})),i.dimensionsChange()}),this.dimensionsSlider.noUiSlider.on("update",function(e){var t=parseInt(e[0]),e=parseInt(e[1]);document.getElementById("min-dimensions").innerHTML=t.toString().toPersianDigits(),document.getElementById("max-dimensions").innerHTML=e.toString().toPersianDigits()})},initmonitorresolutionSlider:function(){let t=this;this.monitorresolution().min=isNaN(parseInt($("#min-resolution").text()))?this.monitorresolution().min_default:parseInt($("#min-resolution").text()),this.monitorresolution().max=isNaN(parseInt($("#max-resolution").text()))?this.monitorresolution().max_default:parseInt($("#max-resolution").text()),this.monitorresolutionChange(),this.monitorresolutionSlider=document.getElementById("resolution-range"),noUiSlider.create(this.monitorresolutionSlider,{start:[this.monitorresolution().min+6,this.monitorresolution().max+6],connect:!0,step:1,direction:"rtl",padding:[6,6],range:{min:this.monitorresolution().min_default,max:this.monitorresolution().max_default+12}}),this.monitorresolutionSlider.noUiSlider.on("change",function(e){document.getElementById("min-resolution").innerHTML=`<span class="ltr">${t.resolutionFormat(e[0])}</span>`,document.getElementById("max-resolution").innerHTML=`<span class="ltr">${t.resolutionFormat(e[1])}</span>`,document.querySelector("#resolution-range .noUi-handle-lower .noUi-touch-area").innerHTML=t.resolutionFormat(e[0]),document.querySelector("#resolution-range .noUi-handle-upper .noUi-touch-area").innerHTML=t.resolutionFormat(e[1]),t.monitorresolution($.extend(t.monitorresolution(),{min:e[0]-6,max:e[1]-6})),t.monitorresolutionChange()}),this.monitorresolutionSlider.noUiSlider.on("update",function(e){document.getElementById("min-resolution").innerHTML=`<span class="ltr">${t.resolutionFormat(e[0])}</span>`,document.getElementById("max-resolution").innerHTML=`<span class="ltr">${t.resolutionFormat(e[1])}</span>`,document.querySelector("#resolution-range .noUi-handle-lower .noUi-touch-area").innerHTML=t.resolutionFormat(e[0]),document.querySelector("#resolution-range .noUi-handle-upper .noUi-touch-area").innerHTML=t.resolutionFormat(e[1])})},resolutionFormat:function(e){e=Number(e);return(e<100?e+"0":1300==e?"1300":e+"00").toPersianDigits()},serviceChange:function(){return 0==this.firstLoadPage()&&this.clearFilters(["service"]),filtersViewModel.refreshServiceTag(),!0},refreshServiceTag:function(){filtersViewModel.removeTagWhere(["type","service"]),""!==filtersViewModel.selectedService()&&$.each(filtersViewModel.services(),function(e,t){filtersViewModel.selectedService()===t.service_id&&filtersViewModel.tags.push({type:"service",value:t.url,title:t.name,service_id:t.service_id,ignore_query:!0})})},attributeChange:function(){return filtersViewModel.removeTagWhere(["type","attr"],!0),$.each(filtersViewModel.attributesGroups(),function(e,t){$.each(t.attributes,function(e,t){0<=filtersViewModel.selectedAttributes().indexOf(t.attribute_id)&&filtersViewModel.tags.push({type:"attr",queryStringType:"array",value:t.url,title:t.name,attribute_id:t.attribute_id})})}),!0},toggleMoreAttributes:function(){filtersViewModel.moreAttributes(!filtersViewModel.moreAttributes())},sort:function(e){this.sortedBy(e),this.submitFilter()},getSort:function(){return this.sortedBy().code==this.defaultSort?"":"sort="+this.sortedBy().code},getQueryStringValue:function(e){return decodeURIComponent(window.location.search.replace(new RegExp("^(?:.*[&\\?]"+encodeURIComponent(e).replace(/[\.\+\*]/g,"\\$&")+"(?:\\=([^&]*))?)?.*$","i"),"$1"))},loadState:function(){var e=parseInt(sessionStorage.getItem("state"));"number"==typeof e&&!isNaN(e)||(e=0),this.state=e},saveCurrentState:function(){var e=JSON.parse(sessionStorage.getItem("tags"));0<(e=null===e?[]:e).length&&this.state++,e[this.state]=this.tags(),sessionStorage.setItem("tags",JSON.stringify(e)),sessionStorage.setItem("state",this.state)},newState:function(){this.state++},setState:function(e){this.state=e}},ko.applyBindings(filtersViewModel,document.getElementById("filters-page")),filtersViewModel.init();
//# sourceMappingURL=filters.min.js.map
